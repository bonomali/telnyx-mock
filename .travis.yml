language: go

go:
  - "1.12"

# magic word to use faster/newer container-based architecture
sudo: false

services:
  - docker

before_install:
  - go get -u golang.org/x/lint/golint
  - go get -u github.com/jteeuwen/go-bindata/...

script:
  - go generate
  - make

  # Build and test the Docker image. It's pushed to Docker Hub as part of the
  # deploy phase.
  - docker build -t "$DOCKER_REPO:${TRAVIS_COMMIT:0:8}" .
  - docker run -d --name telnyx-mock-container -p 12111:12111 "$DOCKER_REPO:${TRAVIS_COMMIT:0:8}"
  - docker ps -a

# deploy:
#   provider: script
#   script: bash scripts/docker_push.sh
#   on:
#     condition: ! -z "$TRAVIS_TAG" || "$TRAVIS_BRANCH" -eq "master"

notifications:
  email:
    on_success: never

# You can create an encrypted variable similar to the one below using:
#
#     travis encrypt --org DOCKER_PASSWORD=password
#
# You'll need the `travis` gem which is correctly configured. For more
# information:
#
#     https://docs.travis-ci.com/user/environment-variables/#Defining-encrypted-variables-in-.travis.yml
#
env:
  global:
    # We're not currently publishing a container, but we'll build it for funsies.
    - DOCKER_REPO="telnyx/telnyx-mock"
    - DOCKER_USERNAME=telnyx
    # the below contains: DOCKER_PASSWORD
    # - secure: "asdfasdfasdf"

notifications:
  slack:
    secure: TAdglasemUBfDQ9KkpK9ovBUYSBabxKGTIgHejuV4QJzEYH6YMrL1ygZlHAaSLl8jy63oQ4SlPEIRYhs61AUhHy2dJ3IqT4EzKs9SSqAFR5l1iHLxlV8z3P0Zhr1dBHXrWevS99UsHLqN/z7jUnR9TgPx23N3NP0koZH3eTtykRagLc5qpa/AAzCNNRXA3V2CX4jKSzYldPY1Z81vm9qSgM7XUvO1CYgsbNBWbBcejN8IKHEdQzZ6PIRKbrLAf4FhDld45IjIklR8ibA0VAE1hZesNHMEzd33YaL0X+JIJoCD0cGwpxQXVZYkEKSacArZHPkavXlf4GZHoKsC5IUEvqR9yu48wyG94TengrZIBoosf4MEJb1GzQiXYvuVwh453l/xL1tKIXlxKhHiIL5sb8eaa6OCb7dpV8ZBQ/EtPcj3tN2bsSz9tpVgDNyWnVhH70hBSaeAhb8ssLq059Y44LdX7OCVKXHuSrmEVWQuAohKRSEeO8/Gq/sUAGwA48JEU5+KjIMYqy08FrK5Rs87qU/EevClSu7hZJ3vtBmMgVo3Vh6xd1355iK2pD2yckenqf2cL5hLMWkhwqYj7i9lV1LB2g9+JKCrLum4/hIWfclv/t1Vzw9kKX8CQFb4GoLdmabdt60IRklPGGx98sQJ8A2u7RUYg0lVoWojO+yWwc=
